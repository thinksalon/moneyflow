(function(){"use strict";var e={5519:function(e,t,n){var i=n(9242),s=n(3396),a=n(7139);const o=e=>((0,s.dD)("data-v-5bf6ffcc"),e=e(),(0,s.Cn)(),e),l=["value"],d={key:0},r=o((()=>(0,s._)("p",null," *버튼을 눌러 로그인할 수 있습니다.",-1))),c={key:1},p=["disabled"],g=["disabled"];function h(e,t,n,o,h,u){const v=(0,s.up)("PageSettingView"),x=(0,s.up)("FlowView"),m=(0,s.up)("ListView");return(0,s.wg)(),(0,s.iD)("div",{class:(0,a.C_)(e.menuMainGrid)},[(0,s._)("div",{class:(0,a.C_)(e.menuGrid)},[(0,s._)("div",{class:(0,a.C_)(e.pageListDiv)},[(0,s.wy)((0,s._)("select",{class:(0,a.C_)(e.pageSelect),"onUpdate:modelValue":t[0]||(t[0]=t=>e.pageName=t),onChange:t[1]||(t[1]=e=>u.selectPageBySelectBox())},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(u.sortExpensePages,(e=>((0,s.wg)(),(0,s.iD)("option",{key:e.id,value:e.page_name},(0,a.zw)(e.page_name),9,l)))),128))],34),[[i.bM,e.pageName]]),(0,s._)("button",{class:(0,a.C_)(e.pageSettingBtn),onClick:t[2]||(t[2]=(...e)=>u.openPageDiv&&u.openPageDiv(...e))},"페이지 설정하기",2),h.isPageDivOpened?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)(e.modal)},[(0,s.Wm)(v,{expenses:h.expenses,expensePages:h.expensePages,isPageEdited:u.isPageEdited,onRemoveEByPageId:u.removeExpenseByPageDelete,onCreateNewPage:u.createNewPage,onEditPage:u.editPage,onRemovePage:u.removePage,onCancelEditingPage:u.cancelEditingPage},null,8,["expenses","expensePages","isPageEdited","onRemoveEByPageId","onCreateNewPage","onEditPage","onRemovePage","onCancelEditingPage"])],2)):(0,s.kq)("",!0),h.isPageDivOpened?((0,s.wg)(),(0,s.iD)("div",{key:1,class:(0,a.C_)(e.modalOverlay),onClick:t[3]||(t[3]=(...e)=>u.closePageDiv&&u.closePageDiv(...e))},null,2)):(0,s.kq)("",!0)],2),(0,s._)("div",{class:(0,a.C_)(e.loginDiv)},[e.loginMode?((0,s.wg)(),(0,s.iD)("div",d,[(0,s._)("button",{class:(0,a.C_)(e.loginBtn),onClick:t[4]||(t[4]=(...t)=>e.loginGoogle&&e.loginGoogle(...t))},"구글 로그인",2),r])):((0,s.wg)(),(0,s.iD)("div",c,[(0,s._)("p",null," 로그인 계정: "+(0,a.zw)(e.email),1),(0,s._)("button",{class:(0,a.C_)(e.logoutBtn),onClick:t[5]||(t[5]=(...t)=>e.signout&&e.signout(...t))},"로그아웃",2)]))],2)],2),(0,s._)("div",{class:(0,a.C_)(e.mainDiv)},[(0,s._)("div",{class:(0,a.C_)(e.pageNameDiv)},[(0,s._)("h2",null,(0,a.zw)(this.pageName),1)],2),(0,s._)("div",{class:(0,a.C_)(e.mainBtnDiv)},[(0,s._)("div",{class:(0,a.C_)(e.saveEditedDiv)},[(0,s._)("button",{class:(0,a.C_)({saveEditedBtn_active:!0===u.isEdited,saveEditedBtn_inactive:!1===u.isEdited}),disabled:!u.isEdited,onClick:t[6]||(t[6]=(...e)=>u.editExpense&&u.editExpense(...e))},"편집한 내용 저장",10,p),(0,s._)("button",{class:(0,a.C_)({cancelEditedBtn_active:!0===u.isEdited,cancelEditedBtn_inactive:!1===u.isEdited}),disabled:!u.isEdited,onClick:t[7]||(t[7]=(...e)=>u.cancelEditingExpense&&u.cancelEditingExpense(...e))},"편집 취소",10,g)],2)],2),(0,s._)("div",{class:(0,a.C_)(e.viewGrid)},[(0,s._)("div",{class:(0,a.C_)(e.flowViewDiv)},[(0,s.Wm)(x,{expenses:h.expenses,onPointClickedLi:u.pointClickedLi,onCancelPointClickedLi:u.cancelPointClickedLi},null,8,["expenses","onPointClickedLi","onCancelPointClickedLi"])],2),(0,s._)("div",{class:(0,a.C_)(e.listViewDiv)},[(0,s.Wm)(m,{expenses:h.expenses,toggleActiveHandler:h.toggleActiveHandler,totalExpenseId:u.totalExpenseId,clickedExpenseId:h.clickedExpenseId,selectedPageId:h.selectedPageId,isAnyOpenedLi:u.isAnyOpenedLi,onCreateNewExpense:u.createNewExpense,onRemoveExpense:u.removeExpense,onCancelEditingExpense:u.cancelEditingExpense,onToggleSubList:u.toggleSubList,onMemoSave:e.memoSave,onOpenOrCloseLi:u.openOrCloseLi},null,8,["expenses","toggleActiveHandler","totalExpenseId","clickedExpenseId","selectedPageId","isAnyOpenedLi","onCreateNewExpense","onRemoveExpense","onCancelEditingExpense","onToggleSubList","onMemoSave","onOpenOrCloseLi"])],2)],2)],2)],2)}n(3767),n(8585),n(8696),n(7658);var u=n(7797);const v="https://dszmaeqcdakyucdonsez.supabase.co",x="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzem1hZXFjZGFreXVjZG9uc2V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2NzIzODUxMzgsImV4cCI6MTk4Nzk2MTEzOH0.-p7uNn_hdw0i6j5FANFYFKCGnU9Pn-QMwML10CLOXTM",m=(0,u.eI)(v,x);function E(e,t,n,i,a,o){return(0,s.wg)(),(0,s.iD)("div")}var f={data(){return{isNewUser:"",session:"",loginMode:!0,email:"",initialPageData:""}},mounted(){this.fetchDataForLogIn(),this.sessionListener()},methods:{async loginGoogle(){const{data:e,error:t}=await m.auth.signInWithOAuth({provider:"google",options:{redirectTo:"https://thinksalon.github.io/moneyflow/"}});console.log("data = ",e),console.log("error = ",t)},async signout(){const e=confirm("로그아웃하시겠습니까?");if(e){const{error:e}=await m.auth.signOut();console.log("error = ",e),null==e?(alert("로그아웃 되었습니다."),window.location.reload(!0)):alert("checking..")}},async fetchDataForLogIn(){const e=await m.from("expense").select().order("order",{ascending:!0}),t=this.session;let n="";function i(e){if(e.user_id===n)return!0}n=null!==t?t.user.id:null;const s=e.data.filter(i),a=s.length;this.isNewUser=!(a>0),this.isNewUser&&null!==t&&await this.insertInitailData(),await this.fetchData()},async insertInitailData(){const e={id:this.getUuidv4(),parents_id:null,category:"총계",amount:0,order:null,level:1,page_id:await this.getPageId()};this.insertData(e)},async getPageId(){return this.initialPageData={id:this.getUuidv4(),page_name:"새 페이지",order:0},await this.insertPageData(this.initialPageData),this.selectedPageId=this.initialPageData.id,this.initialPageData.id},async insertPageData(e){try{const{error:t}=await m.from("expense_page").insert(e);if(t)throw t}catch(t){console.error(t)}},async insertData(e){try{const{error:t}=await m.from("expense").insert(e);if(t)throw t}catch(t){console.error(t)}},async getSession(){const{data:e,error:t}=await m.auth.getSession();return console.log("getSession = ",e),console.log("error = ",t),e},sessionListener(){m.auth.onAuthStateChange(((e,t)=>{this.session=t,this.email=t?.user.email,this.loginBtnHandler()}))},loginBtnHandler(){const e=this.session;this.loginMode=null===e}}},w=n(89);const y=(0,w.Z)(f,[["render",E],["__scopeId","data-v-560c16f1"]]);var _=y;const P=e=>((0,s.dD)("data-v-78dc4299"),e=e(),(0,s.Cn)(),e),D=P((()=>(0,s._)("span",null," : ",-1))),C=P((()=>(0,s._)("span",null," *하위 합계 : ",-1))),I=["value"];function L(e,t,n,o,l,d){const r=(0,s.up)("ListModel"),c=(0,s.up)("NewListModel");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",{class:(0,a.C_)({listViewLiDiv_clicked:!0===this.updateClickedExpenseId,listViewLiDiv:!1===this.updateClickedExpenseId})},[(0,s.wy)((0,s._)("input",{class:(0,a.C_)(e.categoryStyle),"onUpdate:modelValue":t[0]||(t[0]=e=>d.getExpenseById[0].category=e)},null,2),[[i.nr,d.getExpenseById[0].category]]),D,(0,s.wy)((0,s._)("input",{class:(0,a.C_)(e.amountStyle),"onUpdate:modelValue":t[1]||(t[1]=e=>d.getExpenseById[0].amount=e),onInput:t[2]||(t[2]=(...e)=>d.onInputChange&&d.onInputChange(...e))},null,34),[[i.nr,d.getExpenseById[0].amount]])],2),(0,s._)("button",{class:(0,a.C_)(e.moreBtn),onClick:t[3]||(t[3]=(...e)=>d.handlerLiMoreDiv&&d.handlerLiMoreDiv(...e))}," … ",2),l.isLiMoreDivOpened?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)(e.liMoreDiv)},[C,(0,s._)("input",{class:(0,a.C_)(e.amountStyle),value:d.sumExpensesForTotal(d.getExpenseById[0].id),readonly:""},null,10,I)],2)):(0,s.kq)("",!0),(0,s._)("button",{class:(0,a.C_)(e.normalBtn),onClick:t[4]||(t[4]=(...e)=>d.openOrCloseLi&&d.openOrCloseLi(...e))},(0,a.zw)(this.isAnyOpenedLi?"모두 닫기":"모두 펴기"),3),(0,s._)("ol",{class:(0,a.C_)(e.olBgStyle)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(d.sortChildrenByIdAndLevel(d.getExpenseById[0].id,d.getExpenseById[0].level),(t=>((0,s.wg)(),(0,s.iD)("li",{class:(0,a.C_)(e.listViewLiStyle),key:t.index},[(0,s.Wm)(r,{expenses:n.expenses,expenseId:t.id,onRemoveExpense:d.removeExpense,onToggleSubList:d.toggleSubList,toggleActiveHandler:this.toggleActiveHandler[t.id],selectedPageId:n.selectedPageId,clickedExpenseId:n.clickedExpenseId},null,8,["expenses","expenseId","onRemoveExpense","onToggleSubList","toggleActiveHandler","selectedPageId","clickedExpenseId"]),t.show_sub_list?((0,s.wg)(),(0,s.iD)("ol",{key:0,class:(0,a.C_)(e.olBgStyle)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(d.sortChildrenByIdAndLevel(t.id,t.level),(t=>((0,s.wg)(),(0,s.iD)("li",{class:(0,a.C_)(e.listViewLiStyle),key:t.index},[(0,s.Wm)(r,{expenses:n.expenses,expenseId:t.id,onRemoveExpense:d.removeExpense,onToggleSubList:d.toggleSubList,toggleActiveHandler:this.toggleActiveHandler[t.id],selectedPageId:n.selectedPageId,clickedExpenseId:n.clickedExpenseId},null,8,["expenses","expenseId","onRemoveExpense","onToggleSubList","toggleActiveHandler","selectedPageId","clickedExpenseId"]),t.show_sub_list?((0,s.wg)(),(0,s.iD)("ol",{key:0,class:(0,a.C_)(e.olBgStyle)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(d.sortChildrenByIdAndLevel(t.id,t.level),(t=>((0,s.wg)(),(0,s.iD)("li",{class:(0,a.C_)(e.listViewLiStyle),key:t.index},[(0,s.Wm)(r,{expenses:n.expenses,expenseId:t.id,onRemoveExpense:d.removeExpense,onToggleSubList:d.toggleSubList,toggleActiveHandler:this.toggleActiveHandler[t.id],selectedPageId:n.selectedPageId,clickedExpenseId:n.clickedExpenseId},null,8,["expenses","expenseId","onRemoveExpense","onToggleSubList","toggleActiveHandler","selectedPageId","clickedExpenseId"]),t.show_sub_list?((0,s.wg)(),(0,s.iD)("ol",{key:0,class:(0,a.C_)(e.olBgStyle)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(d.sortChildrenByIdAndLevel(t.id,t.level),(t=>((0,s.wg)(),(0,s.iD)("li",{class:(0,a.C_)(e.listViewLiStyle),key:t.index},[(0,s.Wm)(r,{expenses:n.expenses,expenseId:t.id,onRemoveExpense:d.removeExpense,onToggleSubList:d.toggleSubList,toggleActiveHandler:this.toggleActiveHandler[t.id],selectedPageId:n.selectedPageId,clickedExpenseId:n.clickedExpenseId},null,8,["expenses","expenseId","onRemoveExpense","onToggleSubList","toggleActiveHandler","selectedPageId","clickedExpenseId"])],2)))),128)),(0,s.Wm)(c,{expenses:n.expenses,expenseId:t.id,onCreateNewExpense:d.createNewExpense},null,8,["expenses","expenseId","onCreateNewExpense"])],2)):(0,s.kq)("",!0)],2)))),128)),(0,s.Wm)(c,{expenses:n.expenses,expenseId:t.id,onCreateNewExpense:d.createNewExpense},null,8,["expenses","expenseId","onCreateNewExpense"])],2)):(0,s.kq)("",!0)],2)))),128)),(0,s.Wm)(c,{expenses:n.expenses,expenseId:t.id,onCreateNewExpense:d.createNewExpense},null,8,["expenses","expenseId","onCreateNewExpense"])],2)):(0,s.kq)("",!0)],2)))),128)),(0,s.Wm)(c,{expenses:n.expenses,expenseId:d.getExpenseById[0].id,onCreateNewExpense:d.createNewExpense},null,8,["expenses","expenseId","onCreateNewExpense"])],2)],64)}function B(e,t,n,i,a,o){return(0,s.wg)(),(0,s.iD)("div")}var b={data(){return{loginmenuGrid:"loginmenuGrid",menuMainGrid:"menuMainGrid",menuGrid:"menuGrid",viewGrid:"viewGrid",subGrid:"subGrid",mainDiv:"mainDiv",pageNameDiv:"pageNameDiv",pageListDiv:"pageListDiv",loginDiv:"loginDiv",saveEditedDiv:"saveEditedDiv",listViewDiv:"listViewDiv",flowViewDiv:"flowViewDiv",flowViewDiv2:"flowViewDiv2",graphDiv:"graphDiv",listViewLiDiv:"listViewLiDiv",liMoreDiv:"liMoreDiv",unitDiv:"unitDiv",newListDiv:"newListDiv",createNewPageDiv:"createNewPageDiv",newExpenseDiv:"newExpenseDiv",newExpenseLiDiv:"newExpenseLiDiv",listViewLiDiv_clicked:"listViewLiDiv_clicked",mainBtnDiv:"mainBtnDiv",loginBtn:"loginBtn",logoutBtn:"logoutBtn",saveEditedBtn_active:"saveEditedBtn_active",saveEditedBtn_inactive:"saveEditedBtn_inactive",cancelEditedBtn_active:"cancelEditedBtn_active",cancelEditedBtn_inactive:"cancelEditedBtn_inactive",pageEditedBtn_active:"cancelEditedBtn_active",pageEditedBtn_inactive:"cancelEditedBtn_inactive",pageSettingBtn:"pageSettingBtn",flowViewBtn:"flowViewBtn",flowViewBtnDiv:"flowViewBtnDiv",toggleBtn_active:"toggleBtn_active",toggleBtn_inactive:"toggleBtn_inactive",moreBtn:"moreBtn",newExpenseBtn:"newExpenseBtn",newExpenseDoneBtn:"newExpenseDoneBtn",normalBtn:"normalBtn",modal:"modal",modalOverlay:"modalOverlay",pageSelect:"pageSelect",categoryStyle:"categoryStyle",amountStyle:"amountStyle",liAlignStyle:"liAlignStyle",listViewLiStyle:"listViewLiStyle",listViewOlStyle:"listViewOlStyle",olBgStyle:"olBgStyle",pageListStyle:"pageListStyle",pageNameStyle:"pageNameStyle",memo:"memo",pageSettingOlStyle:"pageSettingOlStyle"}}};const S=(0,w.Z)(b,[["render",B],["__scopeId","data-v-8fe632a0"]]);var O=S;const k=e=>((0,s.dD)("data-v-0f76040e"),e=e(),(0,s.Cn)(),e),N=["disabled"],A=k((()=>(0,s._)("span",null," : ",-1))),M=k((()=>(0,s._)("span",null," 하위 합계 : ",-1))),V=["value"],T=k((()=>(0,s._)("span",null," 메모 : ",-1)));function H(e,t,n,o,l,d){return(0,s.wg)(),(0,s.iD)("div",{class:(0,a.C_)(e.liAlignStyle)},[(0,s._)("button",{class:(0,a.C_)({toggleBtn_active:!0===this.toggleActiveHandler,toggleBtn_inactive:!1===this.toggleActiveHandler}),disabled:!this.toggleActiveHandler,onClick:t[0]||(t[0]=e=>d.toggleSubList(d.getExpenseById[0]))},(0,a.zw)(d.getExpenseById[0].show_sub_list?"▼":"▶"),11,N),(0,s._)("div",{class:(0,a.C_)({listViewLiDiv_clicked:!0===this.updateClickedExpenseId,listViewLiDiv:!1===this.updateClickedExpenseId})},[(0,s.wy)((0,s._)("input",{class:(0,a.C_)(e.categoryStyle),"onUpdate:modelValue":t[1]||(t[1]=e=>d.getExpenseById[0].category=e)},null,2),[[i.nr,d.getExpenseById[0].category]]),A,(0,s.wy)((0,s._)("input",{class:(0,a.C_)(e.amountStyle),ref:"amountInput","onUpdate:modelValue":t[2]||(t[2]=e=>d.formattedAmount=e),onInput:t[3]||(t[3]=(...t)=>e.onInputChange&&e.onInputChange(...t))},null,34),[[i.nr,d.formattedAmount]])],2),(0,s._)("button",{class:(0,a.C_)(e.moreBtn),onClick:t[4]||(t[4]=(...e)=>d.handlerLiMoreDiv&&d.handlerLiMoreDiv(...e))}," … ",2),l.isLiMoreDivOpened?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)(e.liMoreDiv)},[(0,s._)("button",{onClick:t[5]||(t[5]=e=>d.removeExpense(d.getExpenseById[0]))},"삭제"),M,(0,s._)("input",{class:(0,a.C_)(e.amountStyle),value:d.sumExpenses(d.getExpenseById[0].id),readonly:""},null,10,V),T,(0,s.wy)((0,s._)("input",{class:(0,a.C_)(e.memo),"onUpdate:modelValue":t[6]||(t[6]=e=>d.getExpenseById[0].memo=e)},null,2),[[i.nr,d.getExpenseById[0].memo]])],2)):(0,s.kq)("",!0)],2)}var j={name:"ListModel",props:{expenseId:{type:String,default:""},expenses:{type:Object,default:()=>{}},toggleActiveHandler:{type:Boolean,default:!0},selectedPageId:{type:String,default:""},clickedExpenseId:{type:String,default:""}},mixins:[O],watch:{selectedPageId:{handler(){this.handlerLiMoreDivForPageChange()},deep:!0}},data(){return{isLiMoreDivOpened:!1,memoSaveBtnHandler:!1}},computed:{formattedAmount:{get(){return this.getExpenseById[0].amount.toLocaleString()},set(e){const t=parseFloat(e.replace(/,/g,""));isNaN(t)||(this.getExpenseById[0].amount=t)}},getExpenseById(){return this.expenses.filter((e=>e.id===this.expenseId))},updateClickedExpenseId(){return this.clickedExpenseId===this.getExpenseById[0].id}},methods:{handlerLiMoreDivForPageChange(){this.isLiMoreDivOpened&&(this.isLiMoreDivOpened=!1)},handlerLiMoreDiv(){this.isLiMoreDivOpened=!this.isLiMoreDivOpened},sumExpenses(e){const t=this.expenses.filter((t=>t.parents_id===e)).reduce(((e,t)=>e+Number(t.amount)),0);return t},removeExpense(e){this.$emit("remove-expense",e),this.handlerLiMoreDivForPageChange()},toggleSubList(e){this.$emit("toggle-sub-list",e)}}};const F=(0,w.Z)(j,[["render",H],["__scopeId","data-v-0f76040e"]]);var J=F;const z=e=>((0,s.dD)("data-v-47a5b104"),e=e(),(0,s.Cn)(),e),U=z((()=>(0,s._)("span",null," : ",-1)));function G(e,t,n,o,l,d){return(0,s.wg)(),(0,s.iD)("div",{class:(0,a.C_)(e.newExpenseDiv)},[(0,s._)("button",{class:(0,a.C_)(e.newExpenseBtn),onClick:t[0]||(t[0]=(...e)=>d.handlerNewListDiv&&d.handlerNewListDiv(...e))},(0,a.zw)(l.newExpenseBtnOpened?"-":"+"),3),l.isNewListDivOpened?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,a.C_)(e.newListDiv)},[(0,s._)("form",{onSubmit:t[3]||(t[3]=(0,i.iM)((e=>d.createNewExpense(d.getExpenseById[0].id,d.getExpenseById[0].level)),["prevent"]))},[(0,s._)("div",{class:(0,a.C_)(e.newExpenseLiDiv)},[(0,s.wy)((0,s._)("input",{class:(0,a.C_)(e.categoryStyle),"onUpdate:modelValue":t[1]||(t[1]=e=>this.newCategory=e),placeholder:"새 리스트 적기"},null,2),[[i.nr,this.newCategory]]),U,(0,s.wy)((0,s._)("input",{class:(0,a.C_)(e.amountStyle),"onUpdate:modelValue":t[2]||(t[2]=e=>this.newAmount=e),placeholder:"0"},null,2),[[i.nr,this.newAmount]])],2),(0,s._)("button",{class:(0,a.C_)(e.newExpenseDoneBtn)},"입력",2)],32)],2)):(0,s.kq)("",!0)],2)}var $={name:"NewListModel",props:{expenseId:{type:String,default:""},expenses:{type:Object,default:()=>{}}},mixins:[O],data(){return{newCategory:"",newAmount:0,isNewListDivOpened:!1,newExpenseBtnOpened:!1}},computed:{getExpenseById(){return this.expenses.filter((e=>e.id===this.expenseId))}},methods:{handlerNewListDiv(){this.isNewListDivOpened=!this.isNewListDivOpened,this.newExpenseBtnOpened=!this.newExpenseBtnOpened,this.newExpenseBtnOpened||(this.newCategory="",this.newAmount=0)},createNewExpense(e,t){this.$emit("create-new-expense",e,t,this.newCategory,this.newAmount),this.newCategory="",this.newAmount=0}}};const R=(0,w.Z)($,[["render",G],["__scopeId","data-v-47a5b104"]]);var Z=R,W={name:"ListView",props:{expenses:{type:Object,default:()=>{}},totalExpenseId:{type:String,default:""},toggleActiveHandler:{type:Object,default:()=>{}},selectedPageId:{type:String,default:""},clickedExpenseId:{type:String,default:""},isAnyOpenedLi:{type:Boolean,default:!1}},mixins:[O],data(){return{isLiMoreDivOpened:!1}},computed:{getExpenseById(){return this.expenses.length>0?this.expenses.filter((e=>e.id===this.totalExpenseId)):[{category:"로딩중..",amount:0,id:""}]},updateClickedExpenseId(){return this.clickedExpenseId===this.getExpenseById[0].id}},watch:{selectedPageId:{handler(){this.handlerLiMoreDivForPageChange()},deep:!0}},methods:{openOrCloseLi(){this.$emit("open-or-close-li")},handlerLiMoreDivForPageChange(){this.isLiMoreDivOpened&&(this.isLiMoreDivOpened=!1)},onInputChange(){this.$nextTick((()=>{const e=!isNaN(this.getExpenseById[0].amount);this.$nextTick((()=>{e||(alert("숫자가 아닌 문자가 입력되었습니다. 숫자로 입력해주시기 바랍니다."),this.getExpenseById[0].amount=this.getExpenseById[0].amount.replace(/[^0-9]/g,""))}))}))},handlerLiMoreDiv(){this.isLiMoreDivOpened=!this.isLiMoreDivOpened},sumExpensesForTotal(e){const t=this.expenses.filter((t=>t.parents_id===e)).reduce(((e,t)=>e+Number(t.amount)),0);return t},removeExpense(e){const t=confirm("삭제하시겠습니까? 삭제 후, '저장'버튼을 눌러야 삭제가 완료됩니다.");t&&this.$emit("remove-expense",e)},sortChildrenByIdAndLevel(e,t){return this.expenses.filter((n=>n.parents_id===e&&n.level===t+1))},toggleSubList(e){this.$emit("toggle-sub-list",e)},createNewExpense(e,t,n,i){this.$emit("create-new-expense",e,t,n,i)},cancelEditingExpense(){const e=confirm("편집을 취소하시겠습니까? 취소하면, 편집 중인 내용은 저장되지 않습니다.");e&&this.$emit("cancel-editing-expense")}},components:{ListModel:J,NewListModel:Z}};const Y=(0,w.Z)(W,[["render",L],["__scopeId","data-v-78dc4299"]]);var q=Y;function X(e,t,n,i,o,l){const d=(0,s.up)("VNetworkGraph");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",{class:(0,a.C_)(e.flowViewBtnDiv)},[(0,s._)("button",{onClick:t[0]||(t[0]=(...e)=>l.formatExpenses&&l.formatExpenses(...e)),class:(0,a.C_)(e.flowViewBtn)},"새로고침",2)],2),(0,s._)("div",{class:(0,a.C_)(e.graphDiv),ref:"graphContainer"},[(0,s.Wm)(d,{ref:"vng",class:"graph",nodes:o.nodes,edges:o.edges,layouts:o.layouts,configs:o.configs,"event-handlers":o.eventHandlers},null,8,["nodes","edges","layouts","configs","event-handlers"])],2)],64)}var K=n(4384),Q=n(2208),ee=n.n(Q),te={name:"FlowView",props:{expenses:{type:Object,default:()=>{}}},mixins:[O],data(){return{nodes:{},edges:{},layouts:{nodes:{}},tooltipElement:null,tooltipTimeout:null,eventHandlers:{"node:click":({node:e})=>{const t=this.nodes[e].id;this.$emit("point-clicked-li",t)},"node:pointerover":({node:e,event:t})=>{this.removeTooltip(),this.tooltipTimeout=setTimeout((()=>{const n=this.nodes[e].size,i=this.nodes[e].name;this.tooltipElement=document.createElement("div"),this.tooltipElement.textContent=`${i} : ${n}`,this.tooltipElement.className="tooltip",this.tooltipElement.style.position="absolute",this.setTooltipPosition(t.clientX,t.clientY),this.$refs.graphContainer.appendChild(this.tooltipElement)}),200)},"node:pointerout":()=>{this.removeTooltip()}},configs:{view:{fitContentMargin:20,grid:{visible:!1,interval:20},autoPanAndZoomOnLoad:"fit-content",autoPanOnResize:!1,onBeforeInitialDisplay:()=>this.formatLayout()},node:{normal:{type:"circle",color:"#4a5c6a",radius:e=>Math.pow(e.size/1e3,.5)},hover:{color:"#F6C5C5"}},edge:{normal:{width:e=>Math.pow(e.size/100,1/4),color:"#D3D2D0"},hover:{color:"#4a5c6a"}}}}},watch:{expenses:{handler(){const e=this.expenses.length;e>0&&this.$nextTick((()=>{this.formatExpenses()}))},deep:!0}},mounted(){document.addEventListener("click",this.handleDocumentClick)},beforeUnmount(){this.removeTooltip(),this.tooltipTimeout=null,document.removeEventListener("click",this.handleDocumentClick)},methods:{handleDocumentClick(e){const t=this.$refs.graphContainer;!t&&t.contains(e.target)||this.$emit("cancel-point-clicked-li")},showTooltip(e,t){console.log("showTooltip"),this.tooltipTimeout&&clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout((()=>{const n=this.nodes[e].size;this.createTooltip(n,t.clientX,t.clientY)}),100)},setTooltipPosition(e,t){this.tooltipElement&&(this.tooltipElement.style.top=`${t}px`,this.tooltipElement.style.left=`${e}px`)},removeTooltip(){this.tooltipElement&&(this.tooltipElement.remove(),this.tooltipElement=null),this.tooltipTimeout&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null)},formatLayout(){const e=30,t="TB";if(Object.keys(this.nodes).length<=1||0==Object.keys(this.edges).length)return;const n=new(ee().graphlib.Graph);n.setGraph({rankdir:t,nodesep:e,edgesep:e,ranksep:4*e}),n.setDefaultEdgeLabel((()=>({}))),Object.entries(this.nodes).forEach((([t,i])=>{n.setNode(t,{label:i.name,width:e,height:e})})),Object.values(this.edges).forEach((e=>{n.setEdge(e.source,e.target)})),ee().layout(n),n.nodes().forEach((e=>{const t=n.node(e).x,i=n.node(e).y;this.layouts.nodes[e]={x:t,y:i}}))},formatExpenses(){const e={};this.expenses.forEach((t=>{e[t.id]={id:t.id,name:t.category,size:t.amount}})),this.nodes=e;const t={};this.expenses.forEach((e=>{null!=e.parents_id&&(t[e.id]={id:e.id,source:e.parents_id,target:e.id,size:e.amount})})),this.edges=t,this.formatLayout();const n=this.$refs.vng;n?.transitionWhile((()=>n.fitToContents()),{duration:0})}},components:{VNetworkGraph:K.tI}};const ne=(0,w.Z)(te,[["render",X]]);var ie=ne;const se=e=>((0,s.dD)("data-v-17857b75"),e=e(),(0,s.Cn)(),e),ae=se((()=>(0,s._)("h2",null,"페이지 설정하기",-1))),oe=se((()=>(0,s._)("h4",null,"새 페이지 만들기",-1))),le=se((()=>(0,s._)("span",null,"새 페이지명: ",-1))),de=se((()=>(0,s._)("h4",null,"기존 페이지 편집하기",-1))),re=["onUpdate:modelValue"],ce=["onClick"],pe=["disabled"],ge=["disabled"];function he(e,t,n,o,l,d){return(0,s.wg)(),(0,s.iD)("div",{class:(0,a.C_)(e.pageListStyle)},[ae,(0,s._)("div",{class:(0,a.C_)(e.createNewPageDiv)},[oe,le,(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>this.newPageName=e),placeholder:"새 페이지명 적기"},null,512),[[i.nr,this.newPageName]]),(0,s._)("button",{onClick:t[1]||(t[1]=(...e)=>d.createNewPage&&d.createNewPage(...e))},"만들기")],2),(0,s._)("div",null,[de,(0,s._)("ol",{class:(0,a.C_)(e.pageSettingOlStyle)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(this.expensePages,(t=>((0,s.wg)(),(0,s.iD)("li",{key:t.id},[(0,s.wy)((0,s._)("input",{class:(0,a.C_)(e.pageNameStyle),"onUpdate:modelValue":e=>t.page_name=e},null,10,re),[[i.nr,t.page_name]]),(0,s._)("button",{onClick:e=>d.removePage(t)},"삭제",8,ce)])))),128))],2),(0,s._)("button",{class:(0,a.C_)({pageEditedBtn_active:!0===n.isPageEdited,pageEditedBtn_inactive:!1===n.isPageEdited}),disabled:!n.isPageEdited,onClick:t[2]||(t[2]=(...e)=>d.editPage&&d.editPage(...e))},"편집한 내용 저장",10,pe),(0,s._)("button",{class:(0,a.C_)({cancelPageEditedBtn_active:!0===n.isPageEdited,cancelPageEditedBtn_inactive:!1===n.isPageEdited}),disabled:!n.isPageEdited,onClick:t[3]||(t[3]=(...e)=>d.cancelEditingPage&&d.cancelEditingPage(...e))},"편집 취소",10,ge)])],2)}var ue={name:"PageListView",props:{expenses:{type:Object,default:()=>{}},expensePages:{type:Object,default:()=>{}},isPageEdited:{type:Boolean,default:!1}},mixins:[O],data(){return{newPageName:""}},methods:{createNewPage(){this.$emit("create-new-page",this.newPageName),this.newPageName=""},editPage(){this.$emit("edit-page")},cancelEditingPage(){const e=confirm("편집을 취소하시겠습니까? 취소하면, 편집 중인 내용은 저장되지 않습니다.");e&&this.$emit("cancel-editing-page")},async removePage(e){const t=confirm("삭제하시겠습니까? 삭제 후, '저장'버튼을 눌러야 삭제가 완료됩니다.");t&&this.$emit("remove-page",e)}}};const ve=(0,w.Z)(ue,[["render",he],["__scopeId","data-v-17857b75"]]);var xe=ve,me={data(){return{totalExpenses:[],expenses:[],fetchedExpenses:[],selectedPageId:"",expensePages:[],fetchedExpensePages:[],isPageDivOpened:!1,toggleActiveHandler:{},clickedExpenseId:""}},mixins:[_,O],components:{ListView:q,FlowView:ie,PageSettingView:xe},mounted(){this.fetchData()},computed:{isAnyOpenedLi(){const e=this.expenses.filter((e=>!0===e.show_sub_list));return e.length>0},sortExpensePages(){const e=this.expensePages;return e.sort(((e,t)=>e.order-t.order))},totalExpenseId(){return this.expenses.length>0?this.expenses.filter((e=>1===e.level))[0].id:"1"},isPageEdited(){const e=this.fetchedExpensePages.map((e=>({name:e.page_name,order:e.order}))).sort(((e,t)=>e.order-t.order)),t=this.expensePages.map((e=>({name:e.page_name,order:e.order}))).sort(((e,t)=>e.order-t.order)),n=JSON.stringify(e),i=JSON.stringify(t),s=(n||"")!=(i||"");return s},isEdited(){const e=this.fetchedExpenses.map((e=>({category:e.category,amount:Number(e.amount),memo:e.memo}))),t=this.expenses.map((e=>({category:e.category,amount:Number(e.amount),memo:e.memo}))),n=JSON.stringify(e),i=JSON.stringify(t),s=(n||"")!=(i||"");return s}},methods:{updatedPageName(){return this.expenses.filter((e=>e.id===this.selectedPageId))[0].name},cancelPointClickedLi(){this.clickedExpenseId=""},openOrCloseLi(){if(this.isAnyOpenedLi)this.expenses.forEach((e=>{e.level>1&&(e.show_sub_list=!1),this.upsertExpense(e)}));else{const e=this.expenses.map((e=>({parents:this.expenses.filter((t=>t.id===e.id)),children:this.expenses.filter((t=>t.parents_id===e.id))})));e.forEach((e=>{const t=e.parents[0];e.children.length>0&&t.level>1?(t.show_sub_list=!0,this.upsertExpense(t)):t.level>1&&(t.show_sub_list=!1,this.upsertExpense(t))}))}},pointClickedLi(e){this.clickedExpenseId=e,this.updateParentsToggle(e)},async cancelEditingPage(){this.expensePages="",this.expensePages=JSON.parse(JSON.stringify(this.fetchedExpensePages))},isThereSamePageNameForEditPage(e){const t=new Set(e.map(JSON.stringify)),n=t.size<e.length;return n},async editPage(){const e=confirm("편집된 내용을 저장하시겠습니까?");if(e){const e=this.expensePages.map((e=>({name:e.page_name}))),t=this.isThereSamePageNameForEditPage(e);if(t)alert("같은 페이지 이름이 있습니다. 다른 이름으로 다시 작성해주시기 바랍니다.");else{const e=this.expensePages.map((e=>e.id)),t=this.fetchedExpensePages.map((e=>e.id)),n=t.filter((t=>!e.includes(t)));n.forEach((e=>this.deletePage(e))),this.expensePages.forEach((e=>this.upsertPage(e))),this.fetchedExpensePages=JSON.parse(JSON.stringify(this.expensePages)),alert("저장되었습니다."),this.selectPageByEditPage()}}},getUuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))},removePage(e){const t=e.order;this.expensePages.forEach((e=>{const n=e.order;if(n>t){const t=this.expensePages[this.expensePages.indexOf(e)];t.order=n-1}})),this.expensePages=this.expensePages.filter((t=>t!==e))},async deletePage(e){this.removeExpenseByPageDelete(e);try{const{error:t}=await m.from("expense_page").delete().eq("id",e);if(t)throw t}catch(t){console.error(t)}},removeExpenseByPageDelete(e){const t=this.totalExpenses.filter((t=>t.page_id==e));t.forEach((e=>this.deleteExpense(e.id)))},async createNewPage(e){const t=this.expensePages.filter((t=>t.page_name==e));if(0==t.length){const t={id:this.getUuidv4(),page_name:e,order:this.setOrderForPage()};await this.upsertPage(t),this.upsertInitailExpense(t.id),await this.fetchDataForPage(),alert("신규 페이지가 생성되었습니다.")}else""==e?alert("페이지 이름이 비어있습니다. 페이지 이름을 작성해주시기 바랍니다."):alert("같은 페이지 이름이 있습니다. 다른 이름으로 다시 작성해주시기 바랍니다.")},async upsertPage(e){try{const{error:t}=await m.from("expense_page").upsert(e);if(t)throw t}catch(t){console.error(t)}},async upsertInitailExpense(e){const t={id:this.getUuidv4(),parents_id:null,category:"총계",amount:0,memo:null,order:null,level:1,page_id:e,show_sub_list:null};this.totalExpenses.push(t),await this.upsertExpense(t)},updateParentsToggle(e){const t=this.expenses.filter((t=>t.id===e))[0],n=this.findParentsExpense(t,[]);n.forEach((e=>{e.level>1&&(e.show_sub_list=!0,this.upsertExpense(e))}))},findParentsExpense(e,t){const n=this.expenses.filter((t=>t.id===e.parents_id));return n.forEach((e=>{t.push(e),this.findParentsExpense(e,t)})),t},toggleSubList(e){this.controlToggleActiveHandler(e),e.level<5&&(e.show_sub_list=!e.show_sub_list,this.upsertExpense(e))},controlToggleActiveHandler(e){5==e.level?this.toggleActiveHandler[e.id]=!1:this.toggleActiveHandler[e.id]=!0},cancelEditingExpense(){this.expenses="",this.expenses=JSON.parse(JSON.stringify(this.fetchedExpenses))},removeExpense(e){const t=e.parents_id,n=e.order;this.expenses.forEach((e=>{const i=e.order;e.parents_id==t&&i>n&&(this.expenses[this.expenses.indexOf(e)].order=i-1)})),this.expenses=this.expenses.filter((t=>t!==e)),this.removeChildrenExpense(e)},removeChildrenExpense(e){const t=this.findChildrenExpense(e,[]);this.expenses=this.expenses.filter((e=>!t.includes(e)))},findChildrenExpense(e,t){const n=this.expenses.filter((t=>t.parents_id===e.id));return n.forEach((e=>{t.push(e),this.findChildrenExpense(e,t)})),t},async upsertExpense(e){try{const{error:t}=await m.from("expense").upsert(e).eq("id",e.id);if(t)throw t}catch(t){console.error(t)}},async deleteExpense(e){try{const{error:t}=await m.from("expense").delete().eq("id",e);if(t)throw t}catch(t){console.error(t)}},editExpense(){const e=confirm("편집된 내용을 저장하시겠습니까?");if(e){const e=this.expenses.map((e=>e.id)),t=this.fetchedExpenses.map((e=>e.id)),n=t.filter((t=>!e.includes(t)));n.forEach((e=>this.deleteExpense(e))),this.expenses.forEach((e=>this.upsertExpense(e))),this.fetchedExpenses=JSON.parse(JSON.stringify(this.expenses)),alert("저장되었습니다.")}},createNewExpense(e,t,n,i){const s=t+1,a={id:this.getUuidv4(),parents_id:e,category:n,amount:i,memo:null,order:this.setOrder(e),level:s,show_sub_list:!1,page_id:this.selectedPageId};this.toggleActiveHandler[a.id]=s<5,this.totalExpenses.push(a),this.expenses.push(a)},setOrder(e){const t=this.expenses.filter((t=>t.parents_id===e)),n=Object.keys(t).length;return n+1},setOrderForPage(){const e=Object.keys(this.expensePages).length;return e},async fetchData(){await this.fetchDataForPage();const e=await m.from("expense").select().order("order",{ascending:!0}),{data:t}=e;this.totalExpenses=t,t.length>0&&(await this.selectPageByLoading(),this.fetchedExpenses=JSON.parse(JSON.stringify(this.expenses)),this.expenses.forEach((e=>{5==e.level&&(this.toggleActiveHandler[e.id]=!1)})))},openPageDiv(){this.isPageDivOpened=!0},closePageDiv(){if(this.isPageEdited){const e="페이지에 편집된 내용이 있습니다. \n [확인]을 누르면, 편집된 내용은 저장되지 않고 진행됩니다. \n *편집 내용을 저장하고 싶은 경우, [취소]>[편집 저장하기] 후 종료",t=confirm(e);t&&(this.isPageDivOpened=!1,this.cancelEditingPage())}else this.isPageDivOpened=!1,this.cancelEditingPage()},async selectPageByLoading(){let e=this.sortExpensePages.filter((e=>0===e.order))[0];void 0!=e?this.selectedPageId=e.id:e=this.initialPageData,this.setPageBySelectPage(e)},selectPageBySelectBox(){const e=this.expensePages.filter((e=>e.page_name===this.pageName))[0];this.selectedPageId=e.id,this.setPageBySelectPage(e)},selectPageByEditPage(){let e=this.expensePages.filter((e=>e.id===this.selectedPageId));0==e.length?(e=this.sortExpensePages.filter((e=>0===e.order))[0],this.selectedPageId=e.id):e=e[0],this.setPageBySelectPage(e)},setPageBySelectPage(e){this.pageName=e.page_name,this.expenses=this.totalExpenses.filter((e=>e.page_id===this.selectedPageId)),this.fetchedExpenses=JSON.parse(JSON.stringify(this.expenses)),this.expenses.forEach((e=>{5==e.level&&(this.toggleActiveHandler[e.id]=!1)}))},async fetchDataForPage(){const e=await m.from("expense_page").select(),{data:t}=e;this.expensePages=t,this.fetchedExpensePages=JSON.parse(JSON.stringify(this.expensePages))}}};const Ee=(0,w.Z)(me,[["render",h],["__scopeId","data-v-5bf6ffcc"]]);var fe=Ee;(0,i.ri)(fe).mount("#app")}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,i,s,a){if(!i){var o=1/0;for(c=0;c<e.length;c++){i=e[c][0],s=e[c][1],a=e[c][2];for(var l=!0,d=0;d<i.length;d++)(!1&a||o>=a)&&Object.keys(n.O).every((function(e){return n.O[e](i[d])}))?i.splice(d--,1):(l=!1,a<o&&(o=a));if(l){e.splice(c--,1);var r=s();void 0!==r&&(t=r)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[i,s,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"===typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"===typeof i.then)return i}var a=Object.create(null);n.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var l=2&s&&i;"object"==typeof l&&!~e.indexOf(l);l=t(l))Object.getOwnPropertyNames(l).forEach((function(e){o[e]=function(){return i[e]}}));return o["default"]=function(){return i},n.d(a,o),a}}(),function(){n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var s,a,o=i[0],l=i[1],d=i[2],r=0;if(o.some((function(t){return 0!==e[t]}))){for(s in l)n.o(l,s)&&(n.m[s]=l[s]);if(d)var c=d(n)}for(t&&t(i);r<o.length;r++)a=o[r],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(c)},i=self["webpackChunkthinksalon2304"]=self["webpackChunkthinksalon2304"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(5519)}));i=n.O(i)})();
//# sourceMappingURL=app.b6616612.js.map